\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{tikz-er2}
\usetikzlibrary{positioning}
\usetikzlibrary{shadows}

\usepackage{subcaption}


\begin{document}
\title{Chess Openings Database Specification}
\author{Yoan Geran \and Colin Geniet}
\maketitle

\tableofcontents

\section{Informal specification}
The general goal of this project is to allow users to study chess openings
with the help of a large chess games database.

For that purpose, the main feature of the database is to allow searching
in the games database for games starting with a specific moves sequence
inputted by users.
More specifically, the search result will include the followings :
\begin{itemize}
\item Statistics on games matching the criteria, that is number of games and
win rates for each side (white/black).
\item Most frequent move after this initial sequence.
\item Most used openings after this initial sequence.
\item Openings matching (or less specific than) the initial sequence.
\item Some games matching those criteria (maybe sorted by ELO rating).
\end{itemize}

Searches can be further refined using additional restraints on game date, location,
event, and players name, ELO rating, nationality.

Users may also look at specific games.
When looking at a game, users may go through the game moves,
see openings matching the game and download the game as a \verb|.pgn| file.

Openings, characterized by an initial moves sequence, may be used when searching
instead of manually inputting a move sequence.
Openings may have variations, that is more specific openings.

Users may register accounts. Registered users may add new games (manually or using \verb|.pgn| files),
players, events and openings to the database. They may edit any of the above if it was
created by themselves. They may also add comments on any game, opening, \dots


\section{Conceptual Analysis}
\subsection{Entity relationship}

\tikzstyle{every entity} = [top color=white, bottom color=blue!30, 
                            draw=blue!50!black!100, drop shadow]
\tikzstyle{every weak entity} = [drop shadow={shadow xshift=.7ex, 
                                 shadow yshift=-.7ex}]
\tikzstyle{every attribute} = [top color=white, bottom color=yellow!20, 
                               draw=yellow, node distance=1cm, drop shadow]
\tikzstyle{every relationship} = [top color=white, bottom color=red!20, 
                                  draw=red!50!black!100, drop shadow]

\begin{center}
\scalebox{.80}{
\begin{tikzpicture}[every edge/.style={link}]
    \node[entity] (game) {Game};
    
    \node[relationship] (white) [below right= 0cm and 1cm of game] {white} edge node [auto] {1} (game);
    \node[relationship] (black) [above right= 0cm and 1cm of game] {black} edge node [auto,swap] {1} (game);
    \node[entity] (player) [above right= 0cm and 1cm of white] {Player} edge (white);
    \draw[link] (player) edge (black);
    
    \node[relationship] (gevent) [above left= 1cm and 0cm of game] {in event} edge node [auto] {1} (game);
    \node[entity] (event) [left= 0.5cm of gevent] {Event} edge (gevent);
    
    \node[relationship] (gopening) [left= 5cm of game] {opening} edge (game);
    \node[entity] (opening) [above= 1cm of gopening] {Opening} edge (gopening);
    \node[relationship] (variation) [above= 0.5cm of opening] {variation};
    \draw[link] (opening.70) edge (variation.283);
    \draw[link] (opening.110) edge (variation.257);
    
    \node[draw,circle,top color=white, bottom color=green!20, draw=green!50!black!100, drop shadow] (obj_is) 
         [above= 5cm of game] {D} edge (game) edge (opening) edge (event) edge (player);
    \node[entity] (object) [above= 1cm of obj_is] {Object} edge node {$\bigcup$} (obj_is);
    
    \node[relationship] (owns) [left= of object] {owns} edge [total] (object);
    \node[entity] (user) [left= of owns] {User} edge (owns);
    
    \node[relationship] (on) [above= 1cm of object] {on} edge (object);
    \node[entity] (comment) [left= of on] {Comment} edge [total] node [auto] {1} (on);
    \node[relationship] (from) [above= 0.8cm of user] {from} edge (user) edge [total] node [auto] {1} (comment);
\end{tikzpicture}
}
\end{center}

\begin{table}[h!]
    \begin{subtable}{3.5cm}
	\begin{tabular}[t]{|cr|}
	\hline
	\multicolumn{2}{|c|}{\textbf{Game}} \\
	\hline 
	id     & \em{primary key} \\
	moves  &                  \\
	date   & \em{optional}    \\
	result &                  \\
	\hline
	\end{tabular}
    \end{subtable}
    ~
    \begin{subtable}{5cm}
	\begin{tabular}[t]{|cr|}
	\hline
	\multicolumn{2}{|c|}{\textbf{Player}} \\
	\hline 
	id              & \em{primary key} \\
	first name      &                  \\
	last name       &                  \\
	FIDE Elo rating & \em{optional}    \\
	nationality     & \em{optional}    \\
	\hline
	\end{tabular}
    \end{subtable}
    ~
    \begin{subtable}{3cm}
	\begin{tabular}[t]{|cr|}
	\hline
	\multicolumn{2}{|c|}{\textbf{Opening}} \\
	\hline 
	id     & \em{primary key} \\
	moves  &                  \\
	name   &                  \\
	\hline
	\end{tabular}
    \end{subtable}
\end{table}
    
\begin{table}[h!]
    \begin{subtable}{3.5cm}
	\begin{tabular}[t]{|cr|}
	\hline
	\multicolumn{2}{|c|}{\textbf{Event}} \\
	\hline
	id     & \em{primary key} \\
	name   &                  \\
	start  & \em{optional}    \\
	end    & \em{optional}    \\
	\hline
	\end{tabular}
    \end{subtable}
    ~
    \begin{subtable}{4cm}
	\begin{tabular}[t]{|cr|}
	\hline
	\multicolumn{2}{|c|}{\textbf{User}} \\
	\hline
	id       & \em{primary key} \\
	name     & \em{key}         \\
	password &                  \\
	\hline
	\end{tabular}
    \end{subtable}
    ~
    \begin{subtable}{3.5cm}
	\begin{tabular}[t]{|cr|}
	\hline
	\multicolumn{2}{|c|}{\textbf{Comment}} \\
	\hline
	id     & \em{primary key} \\
	text   &                  \\
	date   &                  \\
	\hline
	\end{tabular}
    \end{subtable}
\end{table}


\subsection{Integrity Constraint}



\end{document}